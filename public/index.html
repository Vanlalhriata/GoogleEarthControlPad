<!doctype HTML>
<html>
<head>
	
</head>

<body>

	<div id="map3d" style="width: 800px; height: 600px;"></div>

	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">

    	var socket = io();

    </script>

    <script type="text/javascript" src="https://www.google.com/jsapi"> </script>
	<script type="text/javascript">

		var ge;
		google.load("earth", "1", {"other_params":"sensor=true_or_false"});

		function init() {
			google.earth.createInstance('map3d', initCB, failureCB);
		}

		function initCB(instance) {
			ge = instance;
			ge.getWindow().setVisibility(true);
			ge.getOptions().setFlyToSpeed(ge.SPEED_TELEPORT);	// Needed for continuous view change
		}

		function failureCB(errorCode) {
		}

		google.setOnLoadCallback(init);

	</script>

	<script type="text/javascript">
		$(document).on('ready', function(){

			var speed = 1;

			socket.on('touchmove', function(e){
				
				var lookAt = ge.getView().copyAsLookAt(ge.ALTITUDE_RELATIVE_TO_GROUND);

				// Pan amount should be reduced as range is reduced
				var rangeFactor = lookAt.getRange() / 25000000;

				lookAt.setLongitude(lookAt.getLongitude() - (e.x * speed * rangeFactor));
				lookAt.setLatitude(lookAt.getLatitude() + (e.y * speed * rangeFactor));
				ge.getView().setAbstractView(lookAt);

			});

		})
	</script>

</body>

</html>